name: Run Music Pipeline

on:
  workflow_dispatch:  # lets you trigger it manually from the GitHub UI

jobs:
  run-pipeline:
    runs-on: ubuntu-latest
    steps:

      - name: 📥 Checkout Code
        uses: actions/checkout@v3

      - name: 🐍 Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: 📦 Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          pip install -r requirements.txt

      - name: 🔐 Decode and restore youtube cookies
        run: |
          echo "${{ secrets.YOUTUBE_COOKIES_B64 }}" | base64 -d > youtube_cookies.txt

      - name: 🔐 Set environment variables
        run: |
          echo "SPOTIFY_CLIENT_ID_1=${{ secrets.SPOTIFY_CLIENT_ID_1 }}" >> .env
          echo "SPOTIFY_CLIENT_SECRET_1=${{ secrets.SPOTIFY_CLIENT_SECRET_1 }}" >> .env
          echo "SPOTIFY_CLIENT_ID_2=${{ secrets.SPOTIFY_CLIENT_ID_2 }}" >> .env
          echo "SPOTIFY_CLIENT_SECRET_2=${{ secrets.SPOTIFY_CLIENT_SECRET_2 }}" >> .env
          echo "SPOTIFY_CLIENT_ID_3=${{ secrets.SPOTIFY_CLIENT_ID_3 }}" >> .env
          echo "SPOTIFY_CLIENT_SECRET_3=${{ secrets.SPOTIFY_CLIENT_SECRET_3 }}" >> .env
          echo "GENIUS_TOKEN=${{ secrets.GENIUS_TOKEN }}" >> .env

      - name: 🚀 Run the pipeline
        run: python main.py
